<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Architecture Overview/TokenExtensions Support" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">TokenExtensions | Whirlpools</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://dev.orca.so/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://dev.orca.so/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://dev.orca.so/Architecture Overview/TokenExtensions Support"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TokenExtensions | Whirlpools"><meta data-rh="true" name="description" content="On May 28th 2024, Whirlpool program has been upgraded to support TokenExtensions (aka Token-2022 program)."><meta data-rh="true" property="og:description" content="On May 28th 2024, Whirlpool program has been upgraded to support TokenExtensions (aka Token-2022 program)."><link data-rh="true" rel="icon" href="https://orca.so/favicon.ico"><link data-rh="true" rel="canonical" href="https://dev.orca.so/Architecture Overview/TokenExtensions Support"><link data-rh="true" rel="alternate" href="https://dev.orca.so/Architecture Overview/TokenExtensions Support" hreflang="en"><link data-rh="true" rel="alternate" href="https://dev.orca.so/Architecture Overview/TokenExtensions Support" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.c9dbecda.css">
<script src="/assets/js/runtime~main.db16e35e.js" defer="defer"></script>
<script src="/assets/js/main.72db72cc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="https://orca.so/android-chrome-192x192.png" alt="Orca Logo" class="themedComponent_DHUr themedComponent--light_DIHH"><img src="https://orca.so/android-chrome-192x192.png" alt="Orca Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M"></div><b class="navbar__title text--truncate">Whirlpools</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">SDK Reference</a><ul class="dropdown__menu"><li><a href="/orca_whirlpools_docs/" class="dropdown__link" target="_blank">Rust SDK Reference</a></li><li><a href="/ts/" class="dropdown__link" target="_blank">TS Kit SDK Reference</a></li><li><a href="/legacy/" class="dropdown__link" target="_blank">TS Legacy SDK Reference</a></li></ul></div><a href="https://api.orca.so/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/orca-so/whirlpools" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_bmvg"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV"><div class="docsWrapper_XLvK"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docRoot_HciC"><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class="sidebarViewport_N8x0"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/Architecture Overview/Account Architecture">Architecture Overview</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture Overview/Account Architecture">Account Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture Overview/Price &amp; Ticks">Price &amp; Ticks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture Overview/Understanding Tick Arrays">Understanding Tick Arrays</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture Overview/Tokenized Positions">Tokenized Positions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture Overview/Whirlpool Fees">Understanding Whirlpool Fees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Architecture Overview/Whirlpool Parameters">Whirlpools Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Architecture Overview/TokenExtensions Support">TokenExtensions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/SDKs/Overview">SDKs</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/API">API</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/Examples/Tour de Whirlpool/Overview">Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/More Resources/A Note for Python Devs">More Resources</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_namt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Architecture Overview</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">TokenExtensions</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>TokenExtensions</h1></header>
<p>On May 28th 2024, Whirlpool program has been upgraded to support TokenExtensions (aka Token-2022 program).</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="extension-list">Extension List<a href="#extension-list" class="hash-link" aria-label="Direct link to Extension List" title="Direct link to Extension List">​</a></h2>
<p><strong>Supported</strong></p>
<ul>
<li>TransferFee</li>
<li>InterestBearing (supported since Oct 11th 2024)</li>
<li>MemoTransfer</li>
<li>MetadataPointer</li>
<li>TokenMetadata</li>
<li>ConfidentialTransfer (non-confidential transfer only)</li>
</ul>
<p><strong>Supported if it has initialized TokenBadge</strong></p>
<ul>
<li>PermanentDelegate</li>
<li>TransferHook</li>
<li>MintCloseAuthority</li>
<li>DefaultAccountState (default state must be Initialized)</li>
</ul>
<blockquote>
<p>ℹ️ FreezeAuthority is not extensions, but it requires TokenBadge.
It should be disabled unless there is a reasonable reason (e.g., legal compliance). FreezeAuthority rejection does not apply to TokenProgram tokens, but does apply to TokenExtensions tokens.</p>
</blockquote>
<p><strong>Not Supported</strong></p>
<ul>
<li>Group, GroupPointer</li>
<li>Member, MemberPointer</li>
<li>NonTransferable</li>
<li>All other extensions not listed above</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="new-instructions">New Instructions<a href="#new-instructions" class="hash-link" aria-label="Direct link to New Instructions" title="Direct link to New Instructions">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="v2-instructions">V2 Instructions<a href="#v2-instructions" class="hash-link" aria-label="Direct link to V2 Instructions" title="Direct link to V2 Instructions">​</a></h3>
<p>V2 instructions have been added to handle tokens owned by Token-2022 program.</p>
<ul>
<li>V1 instructions don’t work for pools with Token-2022 tokens.</li>
<li>V2 instructions work for pools with the following combinations. So V2 encompasses V1; an implementation that always uses V2 is simple, but the downside is increased transaction size if ALT is not used because of the larger number of accounts required.<!-- -->
<ul>
<li>Token / Token</li>
<li>Token-2022 / Token</li>
<li>Token / Token-2022</li>
<li>Token-2022 / Token-2022</li>
</ul>
</li>
<li>Token-2022 program requires Mint account for transfer, so the V2 instructions receive token programs and Mint accounts. It must also receive an SPL Memo program to support MemoTransfer.</li>
<li>When dealing with tokens that have TransferHook extension, instructions will receive the accounts used by the hook program as remaining accounts.</li>
<li>To reduce transfer fee, two_hop_swap_v2 transfers token directly from the first pool to the second pool. The user&#x27;s token account is not passed through.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="for-trade">For Trade<a href="#for-trade" class="hash-link" aria-label="Direct link to For Trade" title="Direct link to For Trade">​</a></h4>
<table><thead><tr><th>Instruction</th><th>Corresponding V1</th><th>Notes</th></tr></thead><tbody><tr><td>swap_v2</td><td>swap</td><td></td></tr><tr><td>two_hop_swap_v2</td><td>two_hop_swap</td><td>intermediate token accounts have been eliminated to reduce transfer fee overhead</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="for-liquidity">For Liquidity<a href="#for-liquidity" class="hash-link" aria-label="Direct link to For Liquidity" title="Direct link to For Liquidity">​</a></h4>
<table><thead><tr><th>Instruction</th><th>Corresponding V1</th></tr></thead><tbody><tr><td>increase_liquidity_v2</td><td>increase_liquidity</td></tr><tr><td>decrease_liquidity_v2</td><td>decrease_liquidity</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="for-fees-and-rewards">For Fees and Rewards<a href="#for-fees-and-rewards" class="hash-link" aria-label="Direct link to For Fees and Rewards" title="Direct link to For Fees and Rewards">​</a></h4>
<table><thead><tr><th>Instruction</th><th>Corresponding V1</th></tr></thead><tbody><tr><td>collect_fees_v2</td><td>collect_fees</td></tr><tr><td>collect_reward_v2</td><td>collect_reward</td></tr><tr><td>collect_protocol_fees_v2</td><td>collect_protocol_fees</td></tr><tr><td>set_reward_emissions_v2</td><td>set_reward_emissions</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="for-pool">For Pool<a href="#for-pool" class="hash-link" aria-label="Direct link to For Pool" title="Direct link to For Pool">​</a></h4>
<table><thead><tr><th>Instruction</th><th>Corresponding V1</th></tr></thead><tbody><tr><td>initialize_pool_v2</td><td>initialize_pool</td></tr><tr><td>initialize_reward_v2</td><td>initialize_reward</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="configextension--tokenbadge-instructions">ConfigExtension &amp; TokenBadge Instructions<a href="#configextension--tokenbadge-instructions" class="hash-link" aria-label="Direct link to ConfigExtension &amp; TokenBadge Instructions" title="Direct link to ConfigExtension &amp; TokenBadge Instructions">​</a></h3>
<ul>
<li>initialize_config_extension</li>
<li>set_config_extension_authority</li>
<li>set_token_badge_authority</li>
<li>initialize_token_badge</li>
<li>delete_token_badge</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="token-badge">Token Badge<a href="#token-badge" class="hash-link" aria-label="Direct link to Token Badge" title="Direct link to Token Badge">​</a></h2>
<p>Allowing unrestricted pool creation with tokens that have certain extensions, like PermanentDelegate, was found to pose more risks than benefits. To safely support these types of tokens, the TokenBadge was introduced as a whitelist mechanism.</p>
<p>A TokenBadge is a PDA which allows pools and rewards to be initialized for such tokens. Each wirlpool config can independently whitelist tokens using a TokenBadge account</p>
<p>The TokenBadge itself only records the WhirlpoolsConfig and Mint used at initialization, without any additional information. Its existence signifies that pools and rewards can be initialized for the associated token.</p>
<p><img decoding="async" loading="lazy" alt="TokenBadge" src="/assets/images/token-badge-74d090e9f547aab50adb71cd79657427.png" width="800" height="508" class="img__Ss2"></p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="notes">Notes<a href="#notes" class="hash-link" aria-label="Direct link to Notes" title="Direct link to Notes">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="freeze-authority">Freeze Authority<a href="#freeze-authority" class="hash-link" aria-label="Direct link to Freeze Authority" title="Direct link to Freeze Authority">​</a></h3>
<p>Token-2022 tokens with freeze authority will be rejected unless TokenBadge account is initialized.</p>
<p>If you initialise the pool with your Token-2022 tokens, make sure you have disabled FreezeAuthority.</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="native-token-wsol">Native Token (WSOL)<a href="#native-token-wsol" class="hash-link" aria-label="Direct link to Native Token (WSOL)" title="Direct link to Native Token (WSOL)">​</a></h3>
<p>Token-2022 program has its own Wrapped SOL mint address (9pan9bMn5HatX4EJdBwg9VgCa7Uz5HL8N1m5D3NdXejP). Let&#x27;s call it WSOL-2022.</p>
<p>Whirlpool program rejects WSOL-2022.</p>
<p>WSOL-2022 has no token extensions, so please use original WSOL (So11111111111111111111111111111111111111112).</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="transferfee">TransferFee<a href="#transferfee" class="hash-link" aria-label="Direct link to TransferFee" title="Direct link to TransferFee">​</a></h3>
<p>Anyone can initialize whirlpool with Token-2022 tokens having <code>TransferFeeConfig</code> extension.</p>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="amount-and-otheramountthreshold"><code>amount</code> and <code>otherAmountThreshold</code><a href="#amount-and-otheramountthreshold" class="hash-link" aria-label="Direct link to amount-and-otheramountthreshold" title="Direct link to amount-and-otheramountthreshold">​</a></h4>
<p>The relationship between <code>amount</code>, <code>otherAmountThreshold</code> and <code>TransferFee</code> in each context.</p>
<p>The relationship between amount, otherAmountThreshold and TransferFee in each context.</p>
<p>ExactIn (<code>amount_specified_is_input = true</code>)</p>
<ul>
<li><code>amount</code>: transfer fee Included amount (will be sent from user&#x27;s token account)</li>
<li><code>otherAmountThreshold</code>: transfer fee Excluded amount (will be received at user&#x27;s token account)</li>
</ul>
<p>ExactOut (<code>amount_specified_is_input = false</code>)</p>
<ul>
<li><code>amount</code>: transfer fee Excluded amount (will be received at user&#x27;s token account)</li>
<li><code>otherAmountThreshold</code>: transfer fee Included amount (will be sent from user&#x27;s token account)</li>
</ul>
<p>The user can set conditions on the exact amount going out of and coming into the token account, regardless of fees.</p>
<p>No additional parameters are added to limit the amount of fees. If the fee is changed, the new rate is delayed by two epochs to prevent sudden increases. In the edge case where a fee change is scheduled to take effect within the transaction’s lifetime, transactions that exceed the outgoing and incoming amount thresholds will fail.</p>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="minab-maxab"><code>minA/B</code>, <code>maxA/B</code><a href="#minab-maxab" class="hash-link" aria-label="Direct link to minab-maxab" title="Direct link to minab-maxab">​</a></h4>
<p>Increase Liquidity: <code>maxA</code>, <code>maxB</code>
transfer fee Included amount (will be sent from user&#x27;s token account)</p>
<p>Decrease Liquidity: <code>minA</code>, <code>minB</code>
transfer fee Excluded amount (will be received at user&#x27;s token account)</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="transferhook">TransferHook<a href="#transferhook" class="hash-link" aria-label="Direct link to TransferHook" title="Direct link to TransferHook">​</a></h3>
<p>In order to use TransferHook, the owner of WhirlpoolsConfig must issue a TokenBadge for that token.</p>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="use-of-remaining_accounts">Use of remaining_accounts<a href="#use-of-remaining_accounts" class="hash-link" aria-label="Direct link to Use of remaining_accounts" title="Direct link to Use of remaining_accounts">​</a></h4>
<p>The account used for TransferHook is different for each program used by TransferHook. Therefore, they are received through <code>remaining_accounts</code>.</p>
<p>To clarify the context of accounts passed as <code>remaining_accounts</code>, the v2 instructions receive <code>remaining_accounts_info</code> as data. It is used to classify the accounts contained in <code>remaining_accounts</code>. (e.g. The first 3 are for mintA&#x27;s TransferHook, next 2 are for for mintB&#x27;s TransferHook).</p>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="security-notes">Security notes<a href="#security-notes" class="hash-link" aria-label="Direct link to Security notes" title="Direct link to Security notes">​</a></h4>
<ul>
<li>In solana, indirect re-entrance will be rejected. So transfer hook program cannot call Whirlpool program.</li>
<li>TransferHook program cannot modify transfer amount. It will be called AFTER token transfer processing.</li>
<li>Token-2022 program remove signer and writable flag of the source, destination and owner when calling the TransferHook program even if they are passed as extra accounts. The source and destination are not updated and the owner&#x27;s signature is not used unintentionally.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="tokenbadge-request">TokenBadge request<a href="#tokenbadge-request" class="hash-link" aria-label="Direct link to TokenBadge request" title="Direct link to TokenBadge request">​</a></h4>
<p>The TransferHook extension is a relatively new feature in the ecosystem, and its use cases are still being explored.</p>
<p>While it’s still undecided which types of TransferHook tokens will be eligible for a TokenBadge, the following best practices should guide selection:</p>
<ul>
<li>The code of the TransferHook program is publicly available.</li>
<li>Verifiable Build has been done to ensure the code and program match.</li>
<li>Upgrade authority have been disabled (ideal, but not required)</li>
<li>Only perform processes that pose no risk to the user (e.g. logging)</li>
<li>TransferHook must not block the transfer of tokens, or that the criteria for blocking are clearly declared, fair and reasonable.</li>
<li>TransferHook must not interfere with the operation of the pool. It must not interfere with the trade, deposit, withdraw and harvest.</li>
<li>Extensions that block transactions based on the amount of tokens to be transferred are undesirable because they cause transactions to fail in ways that are surprising to pool users. On the other hand, failing transfers to sanctioned wallets according to some public standard will not obstruct pool usage for many users.</li>
<li>TransferHook must not request large numbers of accounts that would increase transaction size.</li>
<li>TransferHook should not attempt any token transfers (including WSOL and native SOL).</li>
<li>TransferHook should not attempt imposing any kind of additional fees.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/orca-so/whirlpools/tree/main/docs/whirlpool/docs/02-Architecture Overview/07-TokenExtensions Support.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_g62E"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/Architecture Overview/Whirlpool Parameters"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Whirlpools Parameters</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/SDKs/Overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#extension-list" class="table-of-contents__link toc-highlight">Extension List</a></li><li><a href="#new-instructions" class="table-of-contents__link toc-highlight">New Instructions</a><ul><li><a href="#v2-instructions" class="table-of-contents__link toc-highlight">V2 Instructions</a></li><li><a href="#configextension--tokenbadge-instructions" class="table-of-contents__link toc-highlight">ConfigExtension &amp; TokenBadge Instructions</a></li></ul></li><li><a href="#token-badge" class="table-of-contents__link toc-highlight">Token Badge</a></li><li><a href="#notes" class="table-of-contents__link toc-highlight">Notes</a><ul><li><a href="#freeze-authority" class="table-of-contents__link toc-highlight">Freeze Authority</a></li><li><a href="#native-token-wsol" class="table-of-contents__link toc-highlight">Native Token (WSOL)</a></li><li><a href="#transferfee" class="table-of-contents__link toc-highlight">TransferFee</a></li><li><a href="#transferhook" class="table-of-contents__link toc-highlight">TransferHook</a></li></ul></li></ul></div></div></div></div></main></div></div></div><meta itemprop="version" content="0.2.5"><div style="position:fixed;bottom:20px;right:20px;z-index:1000"><button data-tally-open="mRZqGP" data-tally-width="405" data-tally-emoji-text="👋" data-tally-emoji-animation="wave" data-tally-auto-close="0" style="padding:10px 20px;background-color:#FFD15C;color:#13174D;font-size:18px;font-weight:500;border:1px solid #13174D;border-radius:8px;cursor:pointer;box-shadow:3px 2px 6px rgba(0, 0, 0, 0.3);transition:transform 0.2s ease, box-shadow 0.2s ease">Share Feedback</button></div></div>
</body>
</html>