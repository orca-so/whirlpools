"use strict";(self.webpackChunk_orca_so_whirlpools_docs=self.webpackChunk_orca_so_whirlpools_docs||[]).push([[261],{827:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/ata-account-structure-c9d0bc6d62f8bfd886181fab70e8bc78.png"},1184:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(4041);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},1649:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/solscan-tx02-841ae768c50ad662a3ae827d7c2f248d.png"},6148:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/send-tokens-726f38c04336bc715fa2109194e5dcbe.png"},8651:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"Examples/Tour de Whirlpool/Send Tokens","title":"Send Tokens","description":"In this section let\'s set up the wallet to enable sending SOL and tokens.","source":"@site/docs/05-Examples/01-Tour de Whirlpool/05-Send Tokens.md","sourceDirName":"05-Examples/01-Tour de Whirlpool","slug":"/Examples/Tour de Whirlpool/Send Tokens","permalink":"/Examples/Tour de Whirlpool/Send Tokens","draft":false,"unlisted":false,"editUrl":"https://github.com/orca-so/whirlpools/tree/main/docs/whirlpool/docs/05-Examples/01-Tour de Whirlpool/05-Send Tokens.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"sidebar","previous":{"title":"Check Balances","permalink":"/Examples/Tour de Whirlpool/Check Balances"},"next":{"title":"CPI","permalink":"/Examples/CPI"}}');var o=t(1085),i=t(1184);const a={},c="Send Tokens",r={},d=[{value:"Program Implementation",id:"program-implementation",level:2},{value:"Sending SOL",id:"sending-sol",level:2},{value:"Code",id:"code",level:3},{value:"Execution Result",id:"execution-result",level:3},{value:"Key Points",id:"key-points",level:3},{value:"APIs Used",id:"apis-used",level:3},{value:"Sending Tokens",id:"sending-tokens",level:2},{value:"Code",id:"code-1",level:3},{value:"Execution Result",id:"execution-result-1",level:3},{value:"Key Points",id:"key-points-1",level:3},{value:"Additional Info About Associated Token Accounts",id:"additional-info-about-associated-token-accounts",level:3},{value:"Additional Info About resolveOrCreateATA",id:"additional-info-about-resolveorcreateata",level:3},{value:"APIs Used",id:"apis-used-1",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"send-tokens",children:"Send Tokens"})}),"\n",(0,o.jsx)(n.p,{children:"In this section let's set up the wallet to enable sending SOL and tokens."}),"\n",(0,o.jsx)(n.h2,{id:"program-implementation",children:"Program Implementation"}),"\n",(0,o.jsx)(n.p,{children:"If you click on SOL or a token, you have the option to send to another wallet. Let's enable this functionality through a program as well."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"send-tokens",src:t(6148).A+"",width:"712",height:"1076"})}),"\n",(0,o.jsx)(n.h2,{id:"sending-sol",children:"Sending SOL"}),"\n",(0,o.jsx)(n.p,{children:"Let's try sending SOL from a program."}),"\n",(0,o.jsx)(n.h3,{id:"code",children:"Code"}),"\n",(0,o.jsxs)(n.p,{children:["Create a file called ",(0,o.jsx)(n.code,{children:"013_transfer_sol.ts"})," under the src directory containing the following contents. The destination is defined as ",(0,o.jsx)(n.code,{children:"dest_pubkey"}),", but feel free to change it or leave it the same as desired."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'import { Keypair, Connection, SystemProgram, PublicKey, Transaction } from "@solana/web3.js";\nimport secret from "../wallet.json";\n\nconst RPC_ENDPOINT_URL = "https://api.devnet.solana.com";\nconst COMMITMENT = \'confirmed\';\n\nasync function main() {\n  // Initialize a connection to the RPC and read in private key\n  const connection = new Connection(RPC_ENDPOINT_URL, COMMITMENT);\n  const keypair = Keypair.fromSecretKey(new Uint8Array(secret));\n  console.log("endpoint:", connection.rpcEndpoint);\n  console.log("wallet pubkey:", keypair.publicKey.toBase58());\n\n  // SOL destination\n  const dest_pubkey = new PublicKey("vQW71yo6X1FjTwt9gaWtHYeoGMu7W9ehSmNiib7oW5G");\n\n  // Amount to send\n  const amount = 10_000_000; // lamports = 0.01 SOL\n\n  // Build the instruction to send SOL\n  const transfer_ix = SystemProgram.transfer({\n    fromPubkey: keypair.publicKey,\n    toPubkey: dest_pubkey,\n    lamports: amount,\n  });\n\n  // Create a transaction and add the instruction\n  const tx = new Transaction();\n  tx.add(transfer_ix);\n\n  // Send the transaction\n  const signers = [keypair];\n  const signature = await connection.sendTransaction(tx, signers);\n  console.log("signature:", signature);\n\n  // Wait for the transaction to complete\n  const latestBlockhash = await connection.getLatestBlockhash();\n  await connection.confirmTransaction({\n    blockhash: latestBlockhash.blockhash,\n    lastValidBlockHeight: latestBlockhash.lastValidBlockHeight,\n    signature\n  });\n}\n\nmain();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"execution-result",children:"Execution Result"}),"\n",(0,o.jsx)(n.p,{children:"Execute the script and verify that the transaction was successful."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ ts-node ./src/013_transfer_sol.ts\nendpoint: https://api.devnet.solana.com\nwallet pubkey: FptVFacYhPrwScJayvKXvwjGeZRbefnnEcgmSQkoRAXB\nsignature: 2EiiHe5JqpbJTUChaeZwUiAEtRtvD9BwWHqX5pKaHhMA5hPEyCuQwEDLjtjHZY6QnHybLdfTS9Rv6k75tLisnf8N\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Open up the ",(0,o.jsx)(n.a,{href:"https://solscan.io/?cluster=devnet",children:"Devnet version of Solscan"}),' and enter the transaction Id labeled "signature". Verify that 0.01 was sent.']}),"\n",(0,o.jsx)(n.p,{children:"Since the transaction only contains one instruction, #1 is the SOL transfer."}),"\n",(0,o.jsx)(n.p,{children:'If you are unable to find the transaction, make sure that you have the network dropdown in the upper right set to "DEVNET".'}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"solscan-tx-01",src:t(9245).A+"",width:"1200",height:"1149"})}),"\n",(0,o.jsx)(n.h3,{id:"key-points",children:"Key Points"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The basic flow is to add an instruction to a transaction, then execute the transaction."}),"\n",(0,o.jsxs)(n.li,{children:["You can use the ",(0,o.jsx)(n.code,{children:"transfer()"})," method from ",(0,o.jsx)(n.code,{children:"SystemProgram"})," to create an instruction to send SOL."]}),"\n",(0,o.jsx)(n.li,{children:"The sender must sign the transaction for sending SOL."}),"\n",(0,o.jsx)(n.li,{children:"You can also verify transaction transactions executed on Devnet using SolScan."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"apis-used",children:"APIs Used"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://solana-labs.github.io/solana-web3.js/classes/SystemProgram.html#transfer",children:"https://solana-labs.github.io/solana-web3.js/classes/SystemProgram.html#transfer"})}),"\n",(0,o.jsx)(n.h2,{id:"sending-tokens",children:"Sending Tokens"}),"\n",(0,o.jsx)(n.p,{children:"Next, let's try sending Tokens from a program."}),"\n",(0,o.jsx)(n.h3,{id:"code-1",children:"Code"}),"\n",(0,o.jsxs)(n.p,{children:["Create a file named ",(0,o.jsx)(n.code,{children:"014_transfer_token.ts"})," under the src directory with the following contents. The destination is defined as ",(0,o.jsx)(n.code,{children:"dest_pubkey"}),", but feel free to change it or leave it the same as desired."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-tsx",children:'import { Keypair, Connection, PublicKey, Transaction } from "@solana/web3.js";\nimport { TOKEN_PROGRAM_ID, AccountLayout, getAssociatedTokenAddressSync, createTransferCheckedInstruction } from "@solana/spl-token";\nimport { resolveOrCreateATA, ZERO } from "@orca-so/common-sdk";\nimport secret from "../wallet.json";\n\nconst RPC_ENDPOINT_URL = "https://api.devnet.solana.com";\nconst COMMITMENT = \'confirmed\';\n\nasync function main() {\n  // Initialize a connection to the RPC and read in private key\n  const connection = new Connection(RPC_ENDPOINT_URL, COMMITMENT);\n  const keypair = Keypair.fromSecretKey(new Uint8Array(secret));\n  console.log("endpoint:", connection.rpcEndpoint);\n  console.log("wallet pubkey:", keypair.publicKey.toBase58());\n\n  // devSAMO\n  // https://everlastingsong.github.io/nebula/\n  const DEV_SAMO_MINT = new PublicKey("Jd4M8bfJG3sAkd82RsGWyEXoaBXQP7njFzBwEaCTuDa");\n  const DEV_SAMO_DECIMALS = 9;\n\n  // Destination wallet for the devSAMO\n  const dest_pubkey = new PublicKey("vQW71yo6X1FjTwt9gaWtHYeoGMu7W9ehSmNiib7oW5G");\n\n  // Amount to send\n  const amount = 1_000_000_000; // 1 devSAMO\n\n  // Obtain the associated token account from the source wallet\n  const src_token_account = getAssociatedTokenAddressSync(DEV_SAMO_MINT, keypair.publicKey);\n\n  // Obtain the associated token account for the destination wallet.\n  const {address: dest_token_account, ...create_ata_ix} = await resolveOrCreateATA(\n    connection,\n    dest_pubkey,\n    DEV_SAMO_MINT,\n    ()=>connection.getMinimumBalanceForRentExemption(AccountLayout.span),\n    ZERO,\n    keypair.publicKey\n  );\n\n  // Create the instruction to send devSAMO\n  const transfer_ix = createTransferCheckedInstruction(\n    src_token_account,\n    DEV_SAMO_MINT,\n    dest_token_account,\n    keypair.publicKey,\n    amount,\n    DEV_SAMO_DECIMALS,\n    [],\n    TOKEN_PROGRAM_ID\n  );\n\n  // Create the transaction and add the instruction\n  const tx = new Transaction();\n  // Create the destination associated token account (if needed)\n  create_ata_ix.instructions.map((ix) => tx.add(ix));\n  // Send devSAMO\n  tx.add(transfer_ix);\n\n  // Send the transaction\n  const signers = [keypair];\n  const signature = await connection.sendTransaction(tx, signers);\n  console.log("signature:", signature);\n\n  // Wait for the transaction to be confirmed\n  const latest_blockhash = await connection.getLatestBlockhash();\n  await connection.confirmTransaction({signature, ...latest_blockhash});\n}\n\nmain();\n'})}),"\n",(0,o.jsx)(n.h3,{id:"execution-result-1",children:"Execution Result"}),"\n",(0,o.jsx)(n.p,{children:"Run the code, and then verify that the devSAMO token has been sent."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ ts-node ./src/014_transfer_token.ts\nendpoint: https://api.devnet.solana.com\nwallet pubkey: FptVFacYhPrwScJayvKXvwjGeZRbefnnEcgmSQkoRAXB\nsignature: 4NXrCbHJHBqgV4oDnWHCPFe7emiVf9SmRjqGxEgKFRAu2Wc8LrmWScygUfdfzZjCifjj4xsmnVke9EVxixceCXjk\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"solscan-tx-02",src:t(1649).A+"",width:"909",height:"1087"})}),"\n",(0,o.jsx)(n.h3,{id:"key-points-1",children:"Key Points"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["You can create an instruction to send a token using the ",(0,o.jsx)(n.code,{children:"createTransferCheckedInstruction()"})," method from the Token class."]}),"\n",(0,o.jsxs)(n.li,{children:["The destination address in the ",(0,o.jsx)(n.code,{children:"createTransferCheckedInstruction()"})," method is the associated token account, not the destination wallet."]}),"\n",(0,o.jsx)(n.li,{children:"If a destination associated token account does not exist yet, it needs to be created. (Since SOL is needed to create the account, choosing not to create a new account is also an option)"}),"\n",(0,o.jsxs)(n.li,{children:["You can obtain the source associated token account address using the ",(0,o.jsx)(n.code,{children:"deriveATA()"})," function."]}),"\n",(0,o.jsxs)(n.li,{children:["You can obtain the destination associated token address and the instructions to create it if needed using the ",(0,o.jsx)(n.code,{children:"resolveOrCreateATA()"})," function."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"additional-info-about-associated-token-accounts",children:"Additional Info About Associated Token Accounts"}),"\n",(0,o.jsx)(n.p,{children:"When sending SOL, the public key of the destination wallet is specified as the destination, and the account associated with this public key is the one that is updated."}),"\n",(0,o.jsx)(n.p,{children:"On the other hand, when sending tokens, the transfer occurs between associated token accounts (ATA). Normally, the user will not notice this is happening behind the scenes, since wallets, such as Phantom, can handle sending tokens using the public key of the destination wallet. However, when sending tokens from a program, you do need to be concerned with sending tokens from one ATA to another ATA."}),"\n",(0,o.jsx)(n.p,{children:"In addition, if the destination wallet has not previously interacted with the token being sent, it is possible that an ATA has not yet been created. In that case, the source needs to create the account on behalf of the destination, or the destination needs to create the account in advance."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"ata-account-structure",src:t(827).A+"",width:"421",height:"486"})}),"\n",(0,o.jsx)(n.h3,{id:"additional-info-about-resolveorcreateata",children:"Additional Info About resolveOrCreateATA"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"resolveOrCreateATA"})," derives an ATA (use deriveATA if this is all that is needed) in addition to building the instructions required to create an associated token account."]}),"\n",(0,o.jsx)(n.p,{children:"One convenient aspect of this function is that it will verify if the ATA already exists, and only build the instructions if they are needed. Because of this, the client can write code to handle this situation without the need for branching."}),"\n",(0,o.jsxs)(n.p,{children:["You can handle sending tokens in a similar fashion without using ",(0,o.jsx)(n.code,{children:"resolveOrCreateATA"}),", but because of the convenience they provide alongside the Whirlpools SDK, we highlighted and used the ",(0,o.jsx)(n.code,{children:"deriveATA"})," and ",(0,o.jsx)(n.code,{children:"resolveOrCreateATA"})," functions in this section."]}),"\n",(0,o.jsx)(n.h3,{id:"apis-used-1",children:"APIs Used"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Token.createTransferCheckedInstruction"}),"\n",(0,o.jsx)(n.li,{children:"deriveATA"}),"\n",(0,o.jsx)(n.li,{children:"resolveOrCreateATA"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"This completes the Basic Wallet Functionality (Sending) section!"})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},9245:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/solscan-tx01-f0db30af63b44c22018fda1f81a9643f.avif"}}]);